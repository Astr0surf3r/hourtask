<div class="container">

<p id="notice"><%= notice %></p>

<div class="row">
  <div class="col">  
    <h1><%= @project.name %>'s Tasks</h1>
  </div>
  <div class="col">  
    <p><font size="2px"><strong>Total Hours</strong> = Previous Hours Worked + Hours Worked = <%= calculate_previous_hours(@project) %> + <%= @project.tasks.sum(:hours_worked) %> = <strong><%= calculate_previous_hours(@project) + @project.tasks.sum(:hours_worked) %></strong> </font></p>
  </div>
</div>
<table class="table">
  <thead>
    <tr>
      <th>Day</th>
      <th>Start time</th>
      <th>End time</th>
      <th>Description</th>
      <th>Hours Worked</th>
      <th>Project</th>
      <th>Status</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= task.day.strftime('%d/%m/%Y') %></td>
        <td><%= task.start_time.in_time_zone("Tijuana").strftime('%T') %></td>
        <td><%= task.closed? ? task.end_time.strftime('%T') : "-" %></td>
        <td><%= task.description %></td>
        <td><%= task.closed? ? task.hours_worked : "-" %></td>
        <td><%= task.project.name %></td>
        <td><%= 
                if task.closed? 
                  link_to 'Close', '#', class: 'btn btn-sm btn-danger'
                else
                  link_to 'Open', '#', class: 'btn btn-sm btn-success', remote: true
                end
             %>
        </td>
        <td><%#= link_to 'Show', task %></td>
        <td><%= link_to 'Edit', edit_project_task_path(@project, task), remote: true %></td>
        <td><%= link_to 'Destroy', project_task_path(@project, task), method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Task', new_project_task_path(project_id: @project.id), remote: true %>

</div>

<%= render "tasks/dialog" %>